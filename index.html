<!DOCTYPE html>
<html>

<head>
    <meta charset=utf-8 />
    <title>CZ Fragipan Project Sites</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <link rel='icon' href='https://newmapsplus.github.io/favicon.ico' type='image/x-icon' />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
        integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
        crossorigin="" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol/dist/L.Control.Locate.min.css" />

    <link href="https://fonts.googleapis.com/css?family=Quicksand:400,700" rel="stylesheet">

    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Quicksand', sans-serif;
            font-size: 100%;
            color: #1b385a;
        }

        h1 {
            position: absolute;
            margin-top: 0;
            top: 10px;
            left: 15px;
            font-size: 1.5em;
            font-family: 'Quicksand', sans-serif;
            font-weight: 700;
            letter-spacing: .04em;
            padding: 10px 15px;
            /* Add styles to match Leaflet UI elements */
            background: rgba(256, 256, 256, .7);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
            border: 1px solid #ddd;
            border-radius: 5px;
            z-index: 800;
        }

        h2 {
            font-family: 'Quicksand', sans-serif;
            font-size: 1.2em;
            letter-spacing: .04em;

        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }

        #about {
            position: absolute;
            bottom: 20px;
            left: 15px;
            width: 280px;
            padding: 0 15px;
            /* Add styles to match Leaflet UI elements */
            background: rgba(256, 256, 256, .7);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
            border: 1px solid #ddd;
            border-radius: 5px;
            z-index: 800;
        }

        p {
            font-size: .9em;
            line-height: 1.5em;
        }

        a {
            color: #005daa;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        /* Leaflet popup styles */
        .leaflet-popup-content {
            font-family: 'Quicksand', sans-serif;
            font-size: 1.1em;
        }

        /* 
		When browser is 900px high or less
		make the font a little smaller.
		 */
        @media screen and (max-height: 400px) {

            #about p,
            #about h2 {
                font-size: .6em;
            }

            h1 {
                font-size: 1.2em;
            }

            #about h2 {
                font-size: 1em;
            }

            .leaflet-popup-content {
                font-family: 'Quicksand', sans-serif;
                font-size: 0.9em;
            }
        }

        /* Don't display info block when window is very small */
        @media screen and (max-height: 200px) {

            #about {
                display: none;
            }
        }
    </style>
</head>

<body>

    <h1>What's in the pan?</h1>

    <div id='map'></div>

    <section id="about">
        <h2>Site Locations</h2>
        <p>The Critical Zone Pedology Laboratory at UKY began its Fragipan Project in 2019.
        <p>Samples were collected from soils across western Kentucky counties demonstrating fragic properties. Hover over  markers to learn more about the individual sites!</p>
        <p>Map authored by RC Ramsey<br>See other projects at: <a href="https://github.com/RCRamsey">RC Ramsey
                Github</a></p>
    </section>

    <!--Load scripts-->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <!--Most up to date leaflet-->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
        integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
        crossorigin=""></script>
    <!--load script for full projection CRS support in leaflet-->
    <script src='https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.7.2/proj4.js'></script>
    <!-- Load a Leaflet plugin to provide geolocation. -->
    <script src="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol/dist/L.Control.Locate.min.js" charset="utf-8">
    </script>
    <!--Add project site file-->
    <script src="data/hs_fragipan_project_4326.geojson"></script>


    <script>
        var options = {
            center: [37.5999, -86.7],
            zoom: 7.49,
            zoomControl: false
        }


        var locate_options = {
            position: 'topright',
            strings: {
                title: "Show me where I am, yo!"
            }
        }

        var map = L.map('map', options);

        // add zoom control to top right window position
        L.control.zoom({
            position: 'topright'
        }).addTo(map);

        // add geolocation control to top right window position (Leaflet can handle multiple top-right elements)
        L.control.locate(locate_options).addTo(map);

        // Get basemap URL from Leaflet Providers
        var basemap_url = 'https://tiles.stadiamaps.com/tiles/alidade_smooth/{z}/{x}/{y}{r}.png'

        // Get basemap attributes from Leaflet Providers
        var basemap_attributes = {
            attribution: '&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
            minZoom: 1,
            maxZoom: 20
        };
        // request map tiles 
        var tiles = L.tileLayer(basemap_url, basemap_attributes);
        map.addLayer(tiles);

        //add fragipan site data layer using ajax
        var siteLayer = $.getJSON("data/hs_fragipan_project_4326.geojson", function (data) {
            //declare dataLayer assigning geoJson (dataLayer) layer for later reference 
            var dataLayer = L.geoJson(data, {
                //convert point data in layer to circle markers on leaflet
                pointToLayer: function (features, latlng) {
                    return L.circleMarker(latlng);
                },
                filter: function (
                    features
                ) {
                    if (features.geometry.type == "Point") {
                        return features;
                    }
                },
                style: function (features) {
                    return {
                        color: 'black',
                        fillColor: 'black',
                        weight: 1,
                        stroke: 0,
                        fillOpactiy: 0.1,
                        radius: 5,
                    }
                },
                //add popup for each circle marker
                onEachFeature: function (feature, layer) {
                    var p = layer.feature.properties
                    //console.log(p)
                    var popup = `<h2> ${p["County"]} County</h2>${p["soil_series"]} Soil Series<br>` 
                    if(p["updated_so"] != null) {
                        popup += `Pedon # ${p["updated_so"]}`
                    }
                    layer.bindPopup(popup),
                        //mouseover to open popup
                        layer.on("mouseover", function () {
                            this.openPopup();
                        });
                    //mouseout to close popup
                    layer.on("mouseout", function () {
                        this.closePopup();
                    });
                }
            }).addTo(map);
        });

        //z-index is for placement of text or buttons, however,
        //bringToFront should in theory work for layers 
        //console.log gives error "siteLayer.bringToFront is not a function"
        //siteLayer.bringToFront();

        //console confirm siteLayer object creation
        //console.log(siteLayer);

        //have jQuery wait until data loaded to add state/county outline layers
        var state = $.when(siteLayer).done(function () {
            $.getJSON("data/us_states_500k.geojson", function (data) {
                var stateLayer = L.geoJson(data, {
                    style: function (feature) {
                        return {
                            color: '#1b385a',
                            weight: 1.0,
                            fillOpacity: 0,
                            interactive: false
                        };
                    }
                });
                stateLayer.addTo(map)
            });
        });

        //have jQuery wait until data loaded to add state/county outline layers
        var county = $.when(siteLayer).done(function () {
            $.getJSON("data/tl_2019_us_county_4326.geojson", function (data) {
                var countyLayer = L.geoJson(data, {
                    style: function (feature) {
                        return {
                            color:'gray',
                            weight: .7,
                            fillOpacity: 0.2,
                            interactive: false
                        };
                    }
                });
                countyLayer.addTo(map)
            });
        });

        // //add legend to turn layers on and off
        // var sourcesLayers = {
        //     "<b style='color:black; text-shadow: 0px 0px 1px #333;'>Sites</b>": siteLayer,
        //     "<b style='color:navy blue; text-shadow: 0px 0px 1px #333;'>County</b>": county,
        //     "<b style='color:orange; text-shadow: 0px 0px 1px #333;'>State</b>": state,
        // }

        // L.control.layers(null, sourcesLayers, {
        //     collapsed: false
        // }).addTo(map);
    </script>

</body>

</html>