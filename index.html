<!DOCTYPE html>
<html>

<head>
    <meta charset=utf-8 />
    <title>CZ Fragipan Project Sites</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <link rel='icon' href='https://newmapsplus.github.io/favicon.ico' type='image/x-icon' />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
        integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
        crossorigin="" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol/dist/L.Control.Locate.min.css" />

    <link href="https://fonts.googleapis.com/css?family=Quicksand:400,700" rel="stylesheet">

    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Quicksand', sans-serif;
            font-size: 100%;
            color: #3d3d3d;
        }

        h1 {
            position: absolute;
            margin-top: 0;
            top: 10px;
            left: 15px;
            font-size: 1.5em;
            font-family: 'Quicksand', sans-serif;
            font-weight: 700;
            letter-spacing: .04em;
            padding: 10px 15px;
            /* Add styles to match Leaflet UI elements */
            background: rgba(256, 256, 256, .3);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
            border: 1px solid #ddd;
            border-radius: 5px;
            z-index: 800;
        }

        h2 {
            font-family: 'Quicksand', sans-serif;
            font-size: 1.2em;
            letter-spacing: .04em;

        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }

        #about {
            position: absolute;
            bottom: 20px;
            left: 15px;
            width: 280px;
            padding: 0 15px;
            /* Add styles to match Leaflet UI elements */
            background: rgba(256, 256, 256, .3);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
            border: 1px solid #ddd;
            border-radius: 5px;
            z-index: 800;
        }

        p {
            font-size: .9em;
            line-height: 1.5em;
        }

        a {
            color: #005daa;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        /* Leaflet popup styles */
        .leaflet-popup-content {
            font-family: 'Quicksand', sans-serif;
            font-size: 1.1em;
        }

        /* 
		When browser is 900px high or less
		make the font a little smaller.
		 */
        @media screen and (max-height: 400px) {

            #about p,
            #about h2 {
                font-size: .6em;
            }

            h1 {
                font-size: 1.2em;
            }

            #about h2 {
                font-size: 1em;
            }

            .leaflet-popup-content {
                font-family: 'Quicksand', sans-serif;
                font-size: 0.9em;
            }
        }

        /* Don't display info block when window is very small */
        @media screen and (max-height: 200px) {

            #about {
                display: none;
            }
        }
    </style>
</head>

<body>

    <h1>Fragipan Project!</h1>

    <div id='map'></div>

    <section id="about">
        <h2>Site Locations</h2>
        <p>The Critical Zone Pedology Laboratory at the University of Kentucky began its Fragipan Project in 2019.
            Samples were collected from soils across western Kentucky counties demonstrating fragic properties. Learn
            more about the projects individual sites by clicking the markers above.</p>
        <p>Map authored by RC Ramsey<br>See other projects at: <a href="https://github.com/RCRamsey">RC Ramsey
                Github</a></p>
    </section>

    <!--Load scripts-->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <!--Most up to date leaflet-->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
        integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
        crossorigin=""></script>
    <!--load script for full projection CRS support in leaflet-->
    <script src='https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.7.2/proj4.js'></script>
    <!-- Load a Leaflet plugin to provide geolocation. -->
    <script src="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol/dist/L.Control.Locate.min.js" charset="utf-8">
    </script>
    <!--Add project site file-->
    <script src="data/hs_fragipan_project_4326.geojson"></script>


    <script>
        var options = {
            center: [37.8393, -84.2700],
            zoom: 12,
            zoomControl: false
        }


        var locate_options = {
            position: 'topright',
            strings: {
                title: "Show me where I am, yo!"
            }
        }

        var map = L.map('map', options);

        // add zoom control to top right window position
        L.control.zoom({
            position: 'topright'
        }).addTo(map);

        // add geolocation control to top right window position (Leaflet can handle multiple top-right elements)
        L.control.locate(locate_options).addTo(map);

        // Get basemap URL from Leaflet Providers
        var basemap_url = 'https://stamen-tiles-{s}.a.ssl.fastly.net/watercolor/{z}/{x}/{y}.{ext}'

        // Get basemap attributes from Leaflet Providers
        var basemap_attributes = {
            attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href = "http://creativecommons.org/licenses/by/3.0" > CC BY 3.0 < /a> &mdash; Map data &copy; <a href = "https://www.openstreetmap.org/copyright" > OpenStreetMap </a> contributors',
            subdomains: 'abcd',
            minZoom: 1,
            maxZoom: 16,
            ext: 'jpg'
        };
        // request map tiles 
        var tiles = L.tileLayer(basemap_url, basemap_attributes);
        map.addLayer(tiles);

        //add fragipan site data layer using ajax
        var siteLayer = $.getJSON("data/hs_fragipan_project_4326.geojson", function (data) {
            //declare dataLayer assigning geoJson (dataLayer) layer for later reference 
            var dataLayer = L.geoJson(data, {
                //convert point data in layer to circle markers on leaflet
                pointToLayer: function (features, latlng) {
                    return L.circleMarker(latlng);
                },
                filter: function (
                    features
                ) {
                    if (features.geometry.type == "Point") {
                        return features;
                    }
                },
                style: function (features) {
                    return {
                        color: '#8da0cb',
                        fillColor: '#8da0cb',
                        weight: 1,
                        stroke: 0,
                        fillOpactiy: 1,
                        radius: 5
                    }
                },
                //add popup for each circle marker
                onEachFeature: function (feature, layer) {
                    var p = layer.feature.properties
                    //console.log(p)
                    var popup = `<h2> ${p["County"]} County</h2> <br> ${p["soil_series"]} Soil Series<br> Pedon #
                    ${p["updated_so"]}`
                    layer.bindPopup(popup),
                        //mouseover to open popup
                        layer.on("mouseover", function () {
                            this.openPopup();
                        });
                    //mouseout to close popup
                    layer.on("mouseout", function () {
                        this.closePopup();
                    });
                }
            }).addTo(map);
        });
        //console confirm siteLayer object creation
        console.log(siteLayer);

        //have jQuery wait until data loaded to add state/county outline layers
        $.when(siteLayer).done(function () {
            $.getJSON("data/us_states_500k.geojson", function (data) {
                var stateLayer = L.geoJson(data, {
                    style: function (feature) {
                        return {
                            color: 'orange',
                            weight: 1.0,
                            fillOpacity: 0,
                            interactive: false
                        };
                    }
                });
                stateLayer.addTo(map)
            });
        });

        //have jQuery wait until data loaded to add state/county outline layers
        $.when(siteLayer).done(function () {
            $.getJSON("data/tl_2019_us_county_4326.geojson", function (data) {
                var stateLayer = L.geoJson(data, {
                    style: function (feature) {
                        return {
                            color: 'gray',
                            weight: 1.0,
                            fillOpacity: 0,
                            interactive: false
                        };
                    }
                });
                stateLayer.addTo(map)
            });
        });
    </script>

</body>

</html>