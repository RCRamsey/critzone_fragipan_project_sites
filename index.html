<!DOCTYPE html>
<html>

<head>
    <meta charset=utf-8 />
    <title>CZ Fragipan Project Sites</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <link rel='icon' href='https://newmapsplus.github.io/favicon.ico' type='image/x-icon' />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
        integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
        crossorigin="" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol/dist/L.Control.Locate.min.css" />

    <link href="https://fonts.googleapis.com/css?family=Quicksand:400,700" rel="stylesheet">

    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Quicksand', sans-serif;
            font-size: 100%;
            color: #1b385a;
        }

        h1 {
            position: absolute;
            margin-top: 0;
            top: 10px;
            left: 15px;
            font-size: 1.5em;
            font-family: 'Quicksand', sans-serif;
            font-weight: 700;
            letter-spacing: .04em;
            padding: 10px 15px;
            /* Add styles to match Leaflet UI elements */
            background: rgba(256, 256, 256, .7);
            fill-opacity: .7;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
            border: 1px solid #ddd;
            border-radius: 5px;
            z-index: 800;
        }

        h2 {
            font-family: 'Quicksand', sans-serif;
            font-size: 1.2em;
            letter-spacing: .04em;

        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }

        #about {
            position: absolute;
            bottom: 20px;
            left: 15px;
            width: 280px;
            padding: 0 15px;
            /* Add styles to match Leaflet UI elements */
            background: rgba(256, 256, 256, .7);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
            border: 1px solid #ddd;
            border-radius: 5px;
            z-index: 800;
        }

        #info {
            position: absolute;
            margin-top: 0;
            font-family: 'Quicksand', sans-serif;
            font-weight: 700;
            letter-spacing: .04em;
            color: #3d3d3d;
            padding: 5px 10px;
            top: 130px;
            right: 10px;
            z-index: 1000;
            border-radius: 4px;
            border: 1px solid #aaa;
            background: rgba(256, 256, 256, .3);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.4);
        }

        p {
            font-size: .9em;
            line-height: 1.5em;
        }

        a {
            color: #2c394f;
            text-decoration: underline;
        }

        a:hover {
            text-decoration: underline;
        }

        /* Leaflet popup styles */
        .leaflet-popup-content {
            font-family: 'Quicksand', sans-serif;
            font-size: 1.1em;
        }

        /*popup width attempt to manipulate/limit excess space. The goal is to get the popup to display content (text/image) with as little as excess padding as possibleðŸ‘»*/
        .custom .leaflet-popup-content-wrapper {
            border-radius: 0;
            border: 3px solid rgba(0,0,0,0.4);
            color: #aaa;
        }
        /*.leaflet-popup-content-wrapper.leaflet-popup-content{
        } */
        /* .leaflet-popup-tip {
            border-right: 15px solid transparent;
        }  */
        .leaflet-interactive {
            padding: 0 0 0 0;
        }

        /* 
		When browser is 900px high or less
		make the font a little smaller.
		 */
        @media screen and (max-height: 400px) {

            #about p,
            #about h2 {
                font-size: .6em;
            }

            h1 {
                font-size: 1.2em;
            }

            #about h2 {
                font-size: 1em;
            }

            .leaflet-popup-content {
                font-family: 'Quicksand', sans-serif;
                font-size: 0.9em;
            }
        }

        /* Don't display info block when window is very small */
        @media screen and (max-height: 200px) {

            #about {
                display: none;
            }
        }

        #info {
            position: absolute;
            margin-top: 0;
            font-family: 'Quicksand', sans-serif;
            font-weight: 700;
            letter-spacing: .04em;
            color: #3d3d3d;
            padding: 5px 10px;
            top: 130px;
            right: 10px;
            z-index: 1000;
            /*can't place button over map without z index default z index is 0, 1000 is higher than all other panes*/
            border-radius: 4px;
            border: 1px solid #aaa;
            background: rgba(256, 256, 256, .3);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.4);
        }
    </style>
</head>

<body>

    <h1 id='title'>What's in the pan?</h1>

    <div id='map'></div>
    <button id='info'>Info</button>

    <section id="about">
        <h2>Site Locations</h2>
        <p>The Critical Zone Pedology Laboratory at UKY began its Fragipan Project to characterize W. Kentucky's Fragipans in 2019.
            <p>Samples were collected from soils across KY counties demonstrating fragic properties. Hover
                over markers to learn more about the individual sites!</p>
            <p>Map data obtained from <a href="http://www.cbshepard.com/">Critical Zone Pedology Lab</a>, U.S.
            Census Bureau's <a href="https://www.census.gov/geo/maps-data/data/cbf/cbf_state.html">Cartographic Boundary Files (State)</a> & <a
                href="https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file.html">TIGER/Line Shapefiles (county)</a></p>
            <p>Map authored by RC Ramsey<br>See other projects at: <a href="https://github.com/RCRamsey">RC Ramsey Github</a></p>
    </section>

    <!--Load scripts-->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <!--Most up to date leaflet-->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
        integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
        crossorigin=""></script>
    <!--load script for full projection CRS support in leaflet-->
    <script src='https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.7.2/proj4.js'></script>
    <!-- Load a Leaflet plugin to provide geolocation. -->
    <script src="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol/dist/L.Control.Locate.min.js" charset="utf-8">
    </script>
    <!--Add project site file-->
    <script src="data/hs_fragipan_project_4326.geojson"></script>


    <script>
        var options = {
            center: [37.5999, -86.7],
            zoom: 7.49,
            zoomControl: false
        }


        var locate_options = {
            position: 'topright',
            strings: {
                title: "Show me where I am, yo!"
            }
        }

        var map = L.map('map', options);

        // add zoom control to top right window position
        L.control.zoom({
            position: 'topright'
        }).addTo(map);

        // add geolocation control to top right window position (Leaflet can handle multiple top-right elements)
        L.control.locate(locate_options).addTo(map);

        // Get basemap URL from Leaflet Providers
        var basemap_url = 'https://tiles.stadiamaps.com/tiles/alidade_smooth/{z}/{x}/{y}{r}.png'

        // Get basemap attributes from Leaflet Providers
        var basemap_attributes = {
            attribution: '&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
            minZoom: 1,
            maxZoom: 20
        };
        // request map tiles 
        var tiles = L.tileLayer(basemap_url, basemap_attributes);
        map.addLayer(tiles);

        //add fragipan site data layer using ajax
        var siteLayer = $.getJSON("data/hs_fragipan_project_4326.geojson", function (data) {
            //declare dataLayer assigning geoJson (dataLayer) layer for later reference 
            var dataLayer = L.geoJson(data, {
                //convert point data in layer to circle markers on leaflet
                pointToLayer: function (features, latlng) {
                    return L.circleMarker(latlng);
                },
                filter: function (
                    features
                ) {
                    if (features.geometry.type == "Point") {
                        return features;
                    }
                },
                style: function (features) {
                    return {
                        color: 'black',
                        fillColor: 'black',
                        weight: 1,
                        stroke: 0,
                        fillOpactiy: 0.1,
                        radius: 5,
                    }
                },
                //add popup for each circle marker including county of site, soil series, pedon # if available and picture
                onEachFeature: function (feature, layer) {
                    var p = layer.feature.properties
                    //console.log(p)
                    var popup = `<h2> ${p["County"]} County</h2>${p["soil_series"]} Soil Series<br>`
                    if (p["updated_so"] != null) {
                        popup += `NRCS Pedon # ${p["updated_so"]}`
                    }
                    if (p["County"] == "Breckinridge (New Site)") {
                        popup +=
                            '<img src = "graphics/20190723_NB_OSL.jpg" height="275px" width="180px" />'
                    } else if (p["County"] == "Caldwell") {
                        popup +=
                            '<img src="graphics/20191204_CA_9.jpg" height="180px" width="275px" />'
                    } else if (p["County"] == "Christian") {
                        popup +=
                            '<img src="graphics/20190821_CH_OSL.jpg" height="180px" width="275px" />'
                    } else if (p["County"] == "Crittenden") {
                        popup +=
                            '<img src="graphics/20190820_CR_OSL107cm.jpg" height="275px" width="220px" />'
                    } else if (p["County"] == "Grayson") {
                        popup +=
                            '<img src="graphics/20190724_GR_OSL.jpg" height="275px" width="180px" />'
                    } else if (p["County"] == "McLean") {
                        popup +=
                            '<img src="graphics/20190819_McL_Cosmo.jpg" height="275px" width="200px" />'
                    } else if (p["County"] == "Trigg") {
                        popup +=
                            '<img src="graphics/20190822_TR_0cm.jpg" height="180px" width="275px" />'
                    } else if (p["County"] == "Breckinridge (Old Site)") {
                        popup +=
                            '<img src="graphics/20190723_OB_OSL.jpg" height="180px" width="275px" />'
                    }
                    //popup width attempt to elliminate extra spaceðŸ‘»
                    layer.bindPopup(popup), 
                    // {
                    //    'maxWidth': '200',
                    //    'width': '200',
                        
                    // }
                        //mouseover to open popup
                        layer.on("mouseover", function (e) {
                            this.openPopup();
                            e.target.setStyle({
                                fillColor: 'pink',
                                radius: 10,
                            });
                        });
                    //mouseout to close popup and reset layer
                    //console logs error that resetStyle() is not a function?
                    layer.on("mouseout", function (e) {
                        this.closePopup();
                        e.target.resetStyle();
                    });
                }
            }).addTo(map);
        });

        //z-index is for placement of text or buttons, however,
        //bringToFront should in theory work for layers 
        //console.log gives error "siteLayer.bringToFront is not a function"
        //siteLayer.bringToFront();

        //console confirm siteLayer object creation
        //console.log(siteLayer);

        //have jQuery wait until data loaded to add state/county outline layers
        var state = $.when(siteLayer).done(function () {
            $.getJSON("data/us_states_500k.geojson", function (data) {
                var stateLayer = L.geoJson(data, {
                    style: function (feature) {
                        return {
                            color: '#1b385a',
                            weight: 1.0,
                            fillOpacity: 0,
                            interactive: false
                        };
                    }
                });
                stateLayer.addTo(map)
            });
        });

        //load county layer
        //is there a way to click on county layer to produce county name popup while still maintaining the mouseover aspect of the sites data layer? 
        //leaving the interactive option as false so mouseover popups for data sites continues operating
        // var countyLayer =  $.when(siteLayer).done(function(){
        // $.getJSON("data/tl_2019_us_county_4326.geojson", function (data) {
        //         var dataLayer = L.geoJson(data, {
        //             style: function (feature) {
        //                 return {
        //                     color: '#a4b7d4',
        //                     weight: .7,
        //                     fillOpacity: 0.4,
        //                     interactive: false
        //                 };
        //             },
        //             add UI of county name popup
        //             onEachFeature: function (feature, layer) {
        //                 var p = layer.feature.properties
        //                 var popup = `<h2> ${p["NAME"]} County</h2>`
        //                 layer.bindPopup(popup),
        //                     layer.on("click", function (e) {
        //                         this.openPopup();
        //                     })
        //             }
        //         });
        //         dataLayer.addTo(map)
        //     });
        // });

        //create button to maximize map space and reduce about/info/title
        var button = document.querySelector('#info')
        var title = document.querySelector('#title')
        var about = document.querySelector('#about')
        var clicked = false
        button.addEventListener('click', function () {
            clicked = !clicked
            if (clicked) {
                title.style.visibility = 'hidden'
                about.style.visibility = 'hidden'
                button.style.backgroundColor = '#aaa'
                button.style.color = '#fff'
            } else {
                title.style.visibility = 'inherit'
                about.style.visibility = 'inherit'
                button.style.background = 'rgba(256, 256, 256, .3)'
                button.style.color = '#3d3d3d'
            }
        })
        // //add legend to turn layers on and off
        // var sourcesLayers = {
        //     "<b style='color:black; text-shadow: 0px 0px 1px #333;'>Sites</b>": siteLayer,
        //     "<b style='color:navy blue; text-shadow: 0px 0px 1px #333;'>County</b>": county,
        //     "<b style='color:orange; text-shadow: 0px 0px 1px #333;'>State</b>": state,
        // }

        // L.control.layers(null, sourcesLayers, {
        //     collapsed: false
        // }).addTo(map);
    </script>

</body>

</html>